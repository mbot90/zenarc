var app=function(){"use strict";function t(){}function e(t){return t()}function o(){return Object.create(null)}function n(t){t.forEach(e)}function i(t){return"function"==typeof t}function r(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function a(t){t.parentNode&&t.parentNode.removeChild(t)}let s;function c(t){s=t}function d(){if(!s)throw new Error("Function called outside component initialization");return s}function l(t){d().$$.on_mount.push(t)}function u(t){d().$$.on_destroy.push(t)}const p=[],g=[];let k=[];const w=[],m=Promise.resolve();let f=!1;function h(t){k.push(t)}const y=new Set;let v=0;function _(){if(0!==v)return;const t=s;do{try{for(;v<p.length;){const t=p[v];v++,c(t),b(t.$$)}}catch(t){throw p.length=0,v=0,t}for(c(null),p.length=0,v=0;g.length;)g.pop()();for(let t=0;t<k.length;t+=1){const e=k[t];y.has(e)||(y.add(e),e())}k.length=0}while(p.length);for(;w.length;)w.pop()();f=!1,y.clear(),c(t)}function b(t){if(null!==t.fragment){t.update(),n(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(h)}}const S=new Set;function q(t,e){const o=t.$$;null!==o.fragment&&(!function(t){const e=[],o=[];k.forEach((n=>-1===t.indexOf(n)?e.push(n):o.push(n))),o.forEach((t=>t())),k=e}(o.after_update),n(o.on_destroy),o.fragment&&o.fragment.d(e),o.on_destroy=o.fragment=null,o.ctx=[])}function I(t,e){-1===t.$$.dirty[0]&&(p.push(t),f||(f=!0,m.then(_)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function j(r,d,l,u,p,g,k){let w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[-1];const m=s;c(r);const f=r.$$={fragment:null,ctx:[],props:g,update:t,not_equal:p,bound:o(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(d.context||(m?m.$$.context:[])),callbacks:o(),dirty:w,skip_bound:!1,root:d.target||m.$$.root};k&&k(f.root);let y=!1;if(f.ctx=l?l(r,d.props||{},(function(t,e){const o=!(arguments.length<=2)&&arguments.length-2?arguments.length<=2?void 0:arguments[2]:e;return f.ctx&&p(f.ctx[t],f.ctx[t]=o)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](o),y&&I(r,t)),e})):[],f.update(),y=!0,n(f.before_update),f.fragment=!!u&&u(f.ctx),d.target){if(d.hydrate){const t=($=d.target,Array.from($.childNodes));f.fragment&&f.fragment.l(t),t.forEach(a)}else f.fragment&&f.fragment.c();d.intro&&((v=r.$$.fragment)&&v.i&&(S.delete(v),v.i(b))),function(t,o,r,a){const{fragment:s,after_update:c}=t.$$;s&&s.m(o,r),a||h((()=>{const o=t.$$.on_mount.map(e).filter(i);t.$$.on_destroy?t.$$.on_destroy.push(...o):n(o),t.$$.on_mount=[]})),c.forEach(h)}(r,d.target,d.anchor,d.customElement),_()}var v,b,$;c(m)}class C{$destroy(){q(this,1),this.$destroy=t}$on(e,o){if(!i(o))return t;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(o),()=>{const t=n.indexOf(o);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function x(t,e){document.dispatchEvent(function(t,e){let{bubbles:o=!1,cancelable:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=document.createEvent("CustomEvent");return i.initCustomEvent(t,o,n,e),i}(t,Object.assign({version:"3.59.2"},e),{bubbles:!0}))}class E extends C{constructor(t){if(!t||!t.target&&!t.$$inline)throw new Error("'target' is a required option");super()}$destroy(){super.$destroy(),this.$destroy=()=>{console.warn("Component was already destroyed")}}$capture_state(){}$inject_state(){}}const O=[];let N=function(e){let o,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;const i=new Set;function a(t){if(r(e,t)&&(e=t,o)){const t=!O.length;for(const t of i)t[1](),O.push(t,e);if(t){for(let t=0;t<O.length;t+=2)O[t][0](O[t+1]);O.length=0}}}return{set:a,update:function(t){a(t(e))},subscribe:function(r){const s=[r,arguments.length>1&&void 0!==arguments[1]?arguments[1]:t];return i.add(s),1===i.size&&(o=n(a)||t),r(e),()=>{i.delete(s),0===i.size&&o&&(o(),o=null)}}}}(!1),T=!1;const A={local:"http://localhost:8080/build/gokwik.js",dev:"https://dev.pdp.gokwik.co/build/gokwik.js",hdev:"https://dev.pdp.gokwik.co/build/gokwik.js",ndev:"https://dev.pdp.gokwik.co/build/gokwik.js",qa:"https://qa.pdp.gokwik.co/build/gokwik.js",qatwo:"https://qatwo.pdp.gokwik.co/build/gokwik.js",sandbox:"https://sandbox.pdp.gokwik.co/build/gokwik.js",production:"https://pdp.gokwik.co/build/gokwik.js","qa-rto":"https://qa2.pdp.gokwik.co/build/gokwik.js",qaone:"https://qa1.pdp.gokwik.co/build/gokwik.js"},L={local:"http://localhost:8080/integration.js",dev:"https://devhits.gokwik.co/api/v1/events",hdev:"https://devhits.gokwik.co/api/v1/events",ndev:"https://devhits.gokwik.co/api/v1/events",qa:"https://qa-hits.gokwik.co/api/v1/events",qatwo:"https://qa-hits.gokwik.co/api/v1/events",sandbox:"https://sandbox-hits.gokwik.co/api/v1/events",production:"https://hits.gokwik.co/api/v1/events","qa-rto":"https://qa-hits.gokwik.co/api/v1/events",qaone:"https://qa-hits.gokwik.co/api/v1/events"};let P=!1;const D=(t,e)=>{window.gokwikSdk.initCheckout(window.merchantInfo),e&&z("gokwik-button-clicked","onGkClick"),e&&z("checkout_event","stabilityEvent",{name:"checkout_button_clicked",type:"event"})},J=t=>{window.gokwikSdk={},window.gokwikSdk.events={},window.gokwikSdk.initCheckout=function(t){window.postMessage(t,window.location.href)},window.gokwikSdk.on=function(t,e){window.gokwikSdk.events[t]=window.gokwikSdk.events[t]||[],window.gokwikSdk.events[t].push(e)},window.gokwikSdk.emit=function(t,e){window.gokwikSdk.events[t]&&window.gokwikSdk.events[t].forEach((function(t){t(e)}))},window.gokwikSdk.hideButton=function(){setInterval((()=>{document.querySelector(".gokwik-container")&&document.querySelectorAll(".gokwik-container").forEach((t=>{t.style.display="none"}))}),1e3)},window.gokwikSdk.init=function(e){if(window.merchantInfo.isNewFlow=!0,e||document.getElementById("gokwikScript")||T){if(e&&e.length)for(var o=0;o<e.length;o++)if(!document.getElementById(e[o].id)){var n=document.createElement("script");n.type="text/javascript",n.src=e[o].src,document.head.appendChild(n),n.id=e[o].id}}else{T=!0,M(A[t])}B()},document.onreadystatechange=function(){"interactive"!==document.readyState&&"complete"!==document.readyState||window.gokwikSdk.init()},document.addEventListener("initGKJS",(function(){window.gokwikSdk.init()})),document.addEventListener("DOMContentLoaded",(function(){try{window.gokwikSdk.init()}catch(t){console.log(t)}})),"complete"===document.readyState&&window.gokwikSdk.init()},M=t=>{var e=document.createElement("script");e.setAttribute("src",t),e.id="gokwikScript",document.head.appendChild(e),document.querySelector(".gokwik-disabled")&&(document.querySelector(".gokwik-disabled").classList.remove("gokwik-disabled"),document.querySelector("#line_r_gokwik").remove())},B=()=>{P||(P=!0,window.addEventListener("gokwikLoaded",(()=>{N.set(!0),gokwikSdk&&gokwikSdk.on("modal_closed",(()=>{F(),window?.merchantInfo?.mmData&&(window.merchantInfo.mmData=null)}))})))},G=t=>{let e,o,n;o={items:[]},e=t.get("pid").split(" "),n=t.get("cp");let i={};if(e){e.map((t=>{i[t]?i[t]+=1:i[t]=1}));Object.keys(i).map((t=>{o.items.push({id:t,quantity:i[t]})}))}return o.items?.length&&(n?K("discount_code",n,0):K("discount_code","",-1)),{pageProducts:e,pageItem:o,pageCoupon:n,productUrl:undefined}},U=function(){let t,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>2?arguments[2]:void 0,n=arguments.length>5?arguments[5]:void 0,i=arguments.length>6?arguments[6]:void 0,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[];o&&o.items?.length?(n.checkoutType="headless",t=JSON.stringify(o)):t=r.length?JSON.stringify({items:r}):window.productFormSelector?JSON.stringify(Q(document.querySelector(window.productFormSelector))):JSON.stringify(R()),e&&(t=Q(document.querySelector(e)),t=JSON.stringify(t)),t=JSON.parse(t);let a="https://homeutility.roposo.com"===window.location.origin,s=a?"/cart/update.js":"/cart/add.js",c=a?{updates:{[t.id]:t.quantity||1}}:t;H("POST",s,c,(function(t){200==t?(D(0,!1),i.items,localStorage.setItem("gkbuynow","active"),K("gkbuynow","active",0)):z("gk_event_failure","development",{statusCode:t,url:s})}))},R=()=>{const t=document.querySelector('[action="/cart/add"]'),e=Q(t);return e.id||(e.id=document.querySelector('[name="id"]')?.value),e.quantity||(e.quantity=document.querySelector('[name="quantity"')?.value),e.form_type="product",e.utf8="âœ“",e},F=()=>{let t=JSON.parse(localStorage.getItem("cartItems"))||JSON.parse(X("cartItems"))||{};if(t&&t.length){let e={items:t};localStorage.removeItem("gkbuynow"),K("gkbuynow",null,-1),H("POST","/cart/clear.js","",(function(t){200===t?H("POST","/cart/add.js",e,(function(t){200==t?(localStorage.removeItem("cartItems"),K("cartItems",null,-1)):z("gk_event_failure","development",{statusCode:t,url:"/cart/add.js"})})):z("gk_event_failure","development",{statusCode:t,url:"/cart/clear.js"})}))}else"active"!==localStorage.getItem("gkbuynow")&&"active"!==X("gkbuynow")||H("POST","/cart/clear.js","",(()=>{localStorage.removeItem("gkbuynow"),K("gkbuynow",null,-1)}))},z=function(t,e){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=L[window.merchantInfo.environment],i=Date.now(),r=navigator.userAgent,a=window.merchantInfo.mid,s=t,c=e,d=X("_shopify_sa_p"),l=localStorage.getItem("gokwik-sessionID")||X("gokwik-sessionID"),u=X("_shopify_s")||null,p={timestamp:i,userAgent:r,version:"1",merchantId:a,name:s,sessionId:l,requestId:"NA",type:"event",adSource:d,eventType:c,...u&&{shopifySessionId:u},landing_page:X("gk_landing_page")||"/",orig_referrer:X("gk_orig_referrer")||"blank",data:o};l||delete p.sessionId,d||delete p.adSource,H("POST",n,p,((t,e)=>{}))},H=async(t,e,o,n)=>{if(!window?.merchantInfo?.modeMagicEnabled||"/cart/add.js"!==e&&"/cart/clear.js"!==e||(e+="?mm=false"),"https://foxtale.in"===window.location.origin&&"/cart/add.js"===e){var i={url:"https://foxtale.in/cart/add.js?_easygift_internal=true",method:"POST","content-type":"application/json",data:o};$.ajax(i).done((function(t,e,o){n(o.status,t)})).fail((function(t,e,o){console.error("Request failed:",e,o)}))}else{let i=(new Date).valueOf(),r=new XMLHttpRequest;r.open(t,e,!0),r.setRequestHeader("Content-type","application/json"),r.onload=function(){let a=r.status,s=r.response,c=(new Date).valueOf();!o.name&&z("gk_execution_time","development",{executionBegan:i,url:e,method:t,executionEnd:c,data:o,response:s,status:a,timeTaken:c-i}),n(a,s)},r.onerror=function(){let t=r.status,n=r.response;"gk_event_failure"!==o.name&&z("gk_event_failure","development",{status:t,response:n,url:e})};let a=o?JSON.stringify(o):null;o?.["properties[_ftmx]"]&&(a=o),r.send(a)}},X=t=>{const e=document.cookie.split(";");for(const o of e){const[e,n]=o.trim().split("=");if(e===t)return decodeURIComponent(n)}return null},K=(t,e,o)=>{let n="";if(o){let t=new Date;t.setTime(t.getTime()+24*o*60*60*1e3),n="; expires="+t.toUTCString()}document.cookie=t+"="+(e||"")+n+"; path=/"},Q=t=>{let e={},o=t.querySelectorAll("input, select, textarea");for(let t=0;t<o.length;++t){let n=o[t],i=n.name,r=n.value;i&&(e[i]=r)}return e},V=()=>{window.addEventListener("message",(async t=>{try{if(!t.data)return;const e=t.data?.messageAuth?.app;if("mode_magic"===e?.toLowerCase().trim()){console.log("mode magic callback received",t.data);const e=t.data;t.data?.messageData?.payload?.cart?.discounts[0];let o=t.data?.messageData?.payload?.cart?.items;o=o.map((t=>{let e={};return t.properties.length&&t.properties.forEach((t=>{e[t.name]=t.value})),{id:t.id,quantity:t.quantity,properties:e}}));const n=o.map((t=>{let{id:e,quantity:o,properties:n}=t;return{id:e,quantity:o,properties:n}}));window.merchantInfo.mmData=e,window.onBuyNowClick(t,!1,n)}}catch(t){console.log(t)}}))};function W(e){const o={c:t,l:function(t){throw new Error("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:t,p:t,i:t,o:t,d:t};return x("SvelteRegisterBlock",{block:o,id:W.name,type:"component",source:"",ctx:e}),o}function Y(t,e,o){let n,i,r,a,{$$slots:s={},$$scope:c}=e;!function(t,e,o){for(const n of Object.keys(e))~o.indexOf(n)||console.warn(`<${t}> received an unexpected slot "${n}".`)}("Main",s,[]);const d=window.merchantInfo;l((()=>{z("gokwik_integration_v2","development"),J(d.environment);const t=new URLSearchParams(window.location.search);t.get("pid")&&(({pageProducts:n,pageItem:i,pageCoupon:r,productUrl:a}=G(t)),N.subscribe((t=>{t&&i.items.length&&p(!1)}))),!X("gk_landing_page")&&K("gk_landing_page",`${window.location.pathname}`,10),!X("gk_orig_referrer")&&K("gk_orig_referrer",document.referrer,10),V()}));const p=function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];H("GET","/cart.js","",(function(o,s){var c=JSON.parse(s);if(200===o&&c.item_count){var l=c.items.map((t=>({id:t.id,quantity:t.quantity,options_with_values:t.options_with_values,properties:t?.properties||{}})));localStorage.setItem("cartItems",JSON.stringify(l)),K("cartItems",JSON.stringify(l),0),H("POST","/cart/clear.js","",(function(o){200===o&&U(t,n,i,r,a,d,c,e)}))}else U(t,n,i,r,a,d,c,e)}))};window.onCheckoutClick=t=>{try{const e=t.lastElementChild;e.setAttribute("id","btn-loader"),t.disabled=!0,t.style.cursor="not-allowed",D(window.merchantInfo,!0),e.style.display="flex",setTimeout((()=>{e.style.display="none",t.disabled=!1,t.style.cursor="pointer",e.removeAttribute("id")}),3e3)}catch(t){z("gk_event_failure","development",{error:t,action:"checkout_clicked"})}},window.gokwikCheckoutClickFn=t=>{try{const e=t.lastElementChild;e.setAttribute("id","btn-loader"),t.disabled=!0,t.style.cursor="not-allowed",D(window.merchantInfo,!0),e.style.display="flex",setTimeout((()=>{e.style.display="none",t.disabled=!1,t.style.cursor="pointer",e.removeAttribute("id")}),3e3)}catch(t){z("gk_event_failure","development",{error:t,action:"checkout_clicked"})}},window.gokwikBuyNowClickFn=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];try{z("gk_buy_now_button_clicked","onGkClick");const n=t.children[0];n.setAttribute("id","btn-loader"),t.disabled=!0,t.style.cursor="not-allowed",window.gokwikSdk.triggerLoadingScreen(),p(e,o),n.style.display="flex",setTimeout((()=>{n.style.display="none",t.disabled=!1,t.style.cursor="pointer",n.removeAttribute("id")}),3e3)}catch(t){window.gokwikSdk.triggerLoadingScreen(),p(e,o),z("gk_event_failure","development",{error:t,action:"buy_now_clicked"})}},window.onBuyNowClick=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];try{z("gk_buy_now_button_clicked","onGkClick"),z("checkout_event","stabilityEvent",{name:"checkout_buy_now_button_clicked",type:"event"});const n=t.children[0];n.setAttribute("id","btn-loader"),t.disabled=!0,t.style.cursor="not-allowed",window.gokwikSdk.triggerLoadingScreen(),p(e,o),n.style.display="flex",setTimeout((()=>{n.style.display="none",t.disabled=!1,t.style.cursor="pointer",n.removeAttribute("id")}),3e3)}catch(t){window.gokwikSdk.triggerLoadingScreen(),p(e,o),z("gk_event_failure","development",{error:t,action:"buy_now_clicked"})}},window.triggerGokwikCustomCheckout=function(){D(window.merchantInfo,!0)};const g=[];return Object.keys(e).forEach((t=>{~g.indexOf(t)||"$$"===t.slice(0,2)||"slot"===t||console.warn(`<Main> was created with unknown prop '${t}'`)})),t.$capture_state=()=>({onDestroy:u,onMount:l,addCartBuyNow:U,createIntegrationScript:J,getGokwikCookie:X,getHeadlessParams:G,initiateGokwik:D,logEvent:z,makeXhr:H,setGokwikCookie:K,store_gokwikLoaded:N,fetchModeMagicDetails:V,pageProducts:n,pageItem:i,pageCoupon:r,productUrl:a,merchantInfo:d,gokwikBuyNow:p}),t.$inject_state=t=>{"pageProducts"in t&&(n=t.pageProducts),"pageItem"in t&&(i=t.pageItem),"pageCoupon"in t&&(r=t.pageCoupon),"productUrl"in t&&(a=t.productUrl)},e&&"$$inject"in e&&t.$inject_state(e.$$inject),[]}return new class extends E{constructor(t){super(t),j(this,t,Y,W,r,{}),x("SvelteRegisterComponent",{component:this,tagName:"Main",options:t,id:W.name})}}({target:window.parent})}();
